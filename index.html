<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>30-Day Discipline Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; }
header { padding:20px; background:#020617; text-align:center; }
header h1 { margin:0; font-size:26px; }
nav { display:flex; justify-content:center; gap:20px; margin-top:10px; }
nav a { color:#38bdf8; text-decoration:none; font-weight:bold; cursor:pointer; }
.container { max-width:900px; margin:auto; padding:20px; }
.card { background:#020617; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 0 15px rgba(0,0,0,0.4); }
button { padding:10px 16px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin:4px; }
.yes { background:#16a34a; color:white; }
.no { background:#dc2626; color:white; }
.water { background:#2563eb; color:white; }
.locked { opacity:0.4; pointer-events:none; }
table { width:100%; border-collapse:collapse; }
th, td { border:1px solid #334155; padding:8px; text-align:center; }
th { background:#020617; }
footer { text-align:center; padding:15px; background:#020617; color:#94a3b8; }
#countdown { margin-top:10px; font-weight:bold; color:#facc15; }
</style>
</head>
<body>

<header>
<h1>30-Day Discipline Tracker</h1>
<p>Fast-Food & Daily Water Tracker</p>
<nav>
<a onclick="showSection('today')">Today</a>
<a onclick="showSection('analytics')">Analytics</a>
<a onclick="showSection('progress')">Friends Progress</a>
<a onclick="resetAll()">Reset</a>
</nav>
</header>

<div class="container">

<div id="today" class="card">
<h2 id="todayDate"></h2>
<h3>Fast Food (Once per day)</h3>
<p id="fastFoodStatus">Not answered</p>
<button id="btnNo" class="yes" onclick="setFastFood('No')">‚ùå No Fast Food</button>
<button id="btnYes" class="no" onclick="setFastFood('Yes')">üçî Ate Fast Food</button>
<hr style="margin:20px 0;">
<h3>Water Intake (400 ml per glass)</h3>
<p id="waterStatus" data-val="0">0 Glasses</p>
<button id="btnWater" class="water" onclick="addWater()">+ 1 Glass</button>
<div id="countdown"></div>
</div>

<div id="analytics" class="card" style="display:none;">
<h2>My Monthly Analytics</h2>
<canvas id="foodChart"></canvas>
<br>
<canvas id="waterChart"></canvas>
<h3>30-Day Table</h3>
<table>
<thead>
<tr><th>Day</th><th>Date</th><th>Fast Food</th><th>Water (ml)</th></tr>
</thead>
<tbody id="historyTable"></tbody>
</table>
</div>

<div id="progress" class="card" style="display:none;">
<h2>Friends Progress</h2>
<table>
<thead>
<tr><th>User</th><th>Date</th><th>Fast Food</th><th>Water (ml)</th><th>Points</th></tr>
</thead>
<tbody id="progressTable"></tbody>
</table>
</div>

</div>

<footer>
Discipline builds freedom ‚Ä¢ Local Data Only
</footer>

<script>
const GLASS_ML = 400;
let data = JSON.parse(localStorage.getItem('tracker')) || {};
let username = localStorage.getItem('username');
if(!username){
  username = prompt('Enter your name:');
  localStorage.setItem('username', username);
}

function todayKey(){ return new Date().toISOString().split('T')[0]; }

function init(){
  document.getElementById('todayDate').innerText = 'Today: ' + new Date().toDateString();
  unlockIfNewDay();
  updateToday();
  startCountdown();
}

function unlockIfNewDay(){
  const last = localStorage.getItem('lastFilled');
  const today = todayKey();
  if(last !== today){ document.querySelectorAll('button').forEach(b => b.classList.remove('locked')); }
}

function setFastFood(val){
  if(!confirm('Confirm?')) return;
  const key = todayKey();
  if(!data[key]) data[key] = { fastFood: null, water: 0, user: username, time: new Date().toLocaleTimeString() };
  if(data[key].fastFood !== null) return;
  data[key].fastFood = val;
  data[key].time = new Date().toLocaleTimeString();
  localStorage.setItem('lastFilled', key);
  save();
  updateToday();
  updateAnalytics();
  updateProgressTable();
}

function addWater(){
  const key = todayKey();
  if(!data[key]) data[key] = { fastFood: null, water: 0, user: username, time: new Date().toLocaleTimeString() };
  data[key].water++;
  save();
  updateToday();
  updateAnalytics();
  updateProgressTable();
}

function updateToday(){
  const key = todayKey();
  const d = data[key];
  if(d){
    document.getElementById('fastFoodStatus').innerText = d.fastFood ?? 'Not answered';
    document.getElementById('waterStatus').innerText = `${d.water} Glasses (${d.water*GLASS_ML} ml)`;
    if(d.fastFood !== null){
      document.getElementById('btnNo').classList.add('locked');
      document.getElementById('btnYes').classList.add('locked');
    }
  }
}

function startCountdown(){
  function tick(){
    const now = new Date();
    const next = new Date();
    next.setHours(24,0,0,0);
    const diff = next - now;
    if(diff <= 0){ document.getElementById('countdown').innerText = 'You can fill now ‚úÖ'; unlockIfNewDay(); return; }
    const h = Math.floor(diff/3600000);
    const m = Math.floor((diff%3600000)/60000);
    const s = Math.floor((diff%60000)/1000);
    document.getElementById('countdown').innerText = `Next fill in: ${h}:${m}:${s}`;
    setTimeout(tick,1000);
  }
  tick();
}

function save(){ localStorage.setItem('tracker', JSON.stringify(data)); }

function showSection(id){
  document.getElementById('today').style.display='none';
  document.getElementById('analytics').style.display='none';
  document.getElementById('progress').style.display='none';
  document.getElementById(id).style.display='block';
  if(id==='analytics') updateAnalytics();
  if(id==='progress') updateProgressTable();
}

function updateAnalytics(){
  const tbody = document.getElementById('historyTable');
  tbody.innerHTML='';
  Object.keys(data).sort().forEach((k,i)=>{
    const d = data[k];
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${k}</td><td>${d.fastFood??'-'}</td><td>${d.water*GLASS_ML}</td></tr>`;
  });
}

function updateProgressTable(){
  const tbody = document.getElementById('progressTable');
  tbody.innerHTML='';
  Object.keys(data).sort().forEach(k=>{
    const d = data[k];
    let points = 0;
    if(d.fastFood==='No') points+=10;
    points += Math.min(d.water,10)*2;
    tbody.innerHTML += `<tr><td>${d.user}</td><td>${k}</td><td>${d.fastFood??'-'}</td><td>${d.water*GLASS_ML}</td><td>${points}</td></tr>`;
  });
}

function resetAll(){ if(confirm('Reset all data?')){ localStorage.clear(); location.reload(); } }

init();
</script>
</body>
</html>
